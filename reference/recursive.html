<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a Recursive Time Series Model from a Parsnip or Workflow Regression Model — recursive • modeltime</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Create a Recursive Time Series Model from a Parsnip or Workflow Regression Model — recursive" />
<meta property="og:description" content="Create a Recursive Time Series Model from a Parsnip or Workflow Regression Model" />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modeltime</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started-with-modeltime.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Forecasting</li>
    <li>
      <a href="../articles/getting-started-with-modeltime.html">Getting Started with Modeltime</a>
    </li>
    <li>
      <a href="../articles/modeltime-model-list.html">Model List</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Developers</li>
    <li>
      <a href="../articles/extending-modeltime.html">Extending Modeltime (Developer Tools)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">API Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/business-science/modeltime">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a Recursive Time Series Model from a Parsnip or Workflow Regression Model</h1>
    <small class="dont-index">Source: <a href='https://github.com/business-science/modeltime/blob/master/R/modeltime-recursive.R'><code>R/modeltime-recursive.R</code></a></small>
    <div class="hidden name"><code>recursive.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Create a Recursive Time Series Model from a Parsnip or Workflow Regression Model</p>
    </div>

    <pre class="usage"><span class='fu'>recursive</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>transform</span>, <span class='va'>train_tail</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>An object of <code>model_fit</code> or a fitted <code>workflow</code> class</p></td>
    </tr>
    <tr>
      <th>transform</th>
      <td><p>A transformation performed on new_data after
each step of recursive algorithm. It can be an object of types:</p><ul>
<li><p><strong>Method 1, <code>recipe</code>:</strong> A recipe generates lagged or sliding features (see examples)</p></li>
<li><p><strong>Method 2, <code>function</code>:</strong> Must have one argument <code>data</code> (see examples)</p></li>
</ul></td>
    </tr>
    <tr>
      <th>train_tail</th>
      <td><p>A tibble with tail of training data set.
In most cases it'll be required to create some variables
based on dependent variable.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Not currently used.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object with added <code>recursive</code> class</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Recursive model can be used if some of the features used for training
is based of dependent variable we already are trying to forecast.
Typically, among these features we can find lags (e.g. created with <code><a href='https://recipes.tidymodels.org/reference/step_lag.html'>step_lag()</a></code>)
or variables crated with sliding window.</p>
<p>When producing forecast, the following steps are performed:</p><ol>
<li><p>Computing forecast for first row of new data.
The first row cannot contain NA in any required column.</p></li>
<li><p>Filling i-th place of the dependent variable column with
already computed forecast.</p></li>
<li><p>Computing missing features for next step, based on
already calculated prediction. These features are computed
with on a tibble object made from binded <code>train_tail</code> (i.e. tail of
training data set) and <code>new_data</code> (which is an argument of predict function).</p></li>
<li><p>Jumping into point 2., and repeating rest of steps till the for-loop is ended.</p></li>
</ol>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Libraries &amp; Setup ----</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/business-science/modeltime'>modeltime</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidymodels.tidymodels.org'>tidymodels</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://lubridate.tidyverse.org'>lubridate</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/business-science/timetk'>timetk</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/DavisVaughan/slider'>slider</a></span><span class='op'>)</span>

<span class='va'>m750</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 306 x 3</span><span>
#&gt;    id    date       value
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;fct&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;date&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> M750  1990-01-01  </span><span style='text-decoration: underline;'>6</span><span>370
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> M750  1990-02-01  </span><span style='text-decoration: underline;'>6</span><span>430
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> M750  1990-03-01  </span><span style='text-decoration: underline;'>6</span><span>520
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> M750  1990-04-01  </span><span style='text-decoration: underline;'>6</span><span>580
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> M750  1990-05-01  </span><span style='text-decoration: underline;'>6</span><span>620
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> M750  1990-06-01  </span><span style='text-decoration: underline;'>6</span><span>690
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> M750  1990-07-01  </span><span style='text-decoration: underline;'>6</span><span>000
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> M750  1990-08-01  </span><span style='text-decoration: underline;'>5</span><span>450
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> M750  1990-09-01  </span><span style='text-decoration: underline;'>6</span><span>480
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> M750  1990-10-01  </span><span style='text-decoration: underline;'>6</span><span>820
#&gt; </span><span style='color: #949494;'># … with 296 more rows</span><span></div><div class='input'>
<span class='va'>FORECAST_HORIZON</span> <span class='op'>&lt;-</span> <span class='fl'>24</span>

<span class='va'>m750_extended</span> <span class='op'>&lt;-</span> <span class='va'>m750</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>id</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://rdrr.io/pkg/timetk/man/future_frame.html'>future_frame</a></span><span class='op'>(</span>
        .length_out <span class='op'>=</span> <span class='va'>FORECAST_HORIZON</span>,
        .bind_data  <span class='op'>=</span> <span class='cn'>TRUE</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>.date_var is missing. Using: date</span></div><div class='input'>
<span class='co'># METHOD 1: RECIPE ----</span>
<span class='co'># - Used for recursive transformations via recipe prepeocessing steps</span>

<span class='co'># Lag Recipe</span>
<span class='va'>recipe_lag</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span><span class='va'>value</span> <span class='op'>~</span> <span class='va'>date</span>, <span class='va'>m750_extended</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_lag.html'>step_lag</a></span><span class='op'>(</span><span class='va'>value</span>, lag <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>FORECAST_HORIZON</span><span class='op'>)</span>

<span class='co'># Data Preparation</span>
<span class='va'>m750_lagged</span> <span class='op'>&lt;-</span> <span class='va'>recipe_lag</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/prep.html'>prep</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/juice.html'>juice</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>m750_lagged</span>
</div><div class='output co'>#&gt; </span><span style='color: #949494;'># A tibble: 330 x 26</span><span>
#&gt;    date       value lag_1_value lag_2_value lag_3_value lag_4_value lag_5_value
#&gt;    </span><span style='color: #949494;font-style: italic;'>&lt;date&gt;</span><span>     </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>       </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 1</span><span> 1990-01-01  </span><span style='text-decoration: underline;'>6</span><span>370          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 2</span><span> 1990-02-01  </span><span style='text-decoration: underline;'>6</span><span>430        </span><span style='text-decoration: underline;'>6</span><span>370          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 3</span><span> 1990-03-01  </span><span style='text-decoration: underline;'>6</span><span>520        </span><span style='text-decoration: underline;'>6</span><span>430        </span><span style='text-decoration: underline;'>6</span><span>370          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 4</span><span> 1990-04-01  </span><span style='text-decoration: underline;'>6</span><span>580        </span><span style='text-decoration: underline;'>6</span><span>520        </span><span style='text-decoration: underline;'>6</span><span>430        </span><span style='text-decoration: underline;'>6</span><span>370          </span><span style='color: #BB0000;'>NA</span><span>          </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 5</span><span> 1990-05-01  </span><span style='text-decoration: underline;'>6</span><span>620        </span><span style='text-decoration: underline;'>6</span><span>580        </span><span style='text-decoration: underline;'>6</span><span>520        </span><span style='text-decoration: underline;'>6</span><span>430        </span><span style='text-decoration: underline;'>6</span><span>370          </span><span style='color: #BB0000;'>NA</span><span>
#&gt; </span><span style='color: #BCBCBC;'> 6</span><span> 1990-06-01  </span><span style='text-decoration: underline;'>6</span><span>690        </span><span style='text-decoration: underline;'>6</span><span>620        </span><span style='text-decoration: underline;'>6</span><span>580        </span><span style='text-decoration: underline;'>6</span><span>520        </span><span style='text-decoration: underline;'>6</span><span>430        </span><span style='text-decoration: underline;'>6</span><span>370
#&gt; </span><span style='color: #BCBCBC;'> 7</span><span> 1990-07-01  </span><span style='text-decoration: underline;'>6</span><span>000        </span><span style='text-decoration: underline;'>6</span><span>690        </span><span style='text-decoration: underline;'>6</span><span>620        </span><span style='text-decoration: underline;'>6</span><span>580        </span><span style='text-decoration: underline;'>6</span><span>520        </span><span style='text-decoration: underline;'>6</span><span>430
#&gt; </span><span style='color: #BCBCBC;'> 8</span><span> 1990-08-01  </span><span style='text-decoration: underline;'>5</span><span>450        </span><span style='text-decoration: underline;'>6</span><span>000        </span><span style='text-decoration: underline;'>6</span><span>690        </span><span style='text-decoration: underline;'>6</span><span>620        </span><span style='text-decoration: underline;'>6</span><span>580        </span><span style='text-decoration: underline;'>6</span><span>520
#&gt; </span><span style='color: #BCBCBC;'> 9</span><span> 1990-09-01  </span><span style='text-decoration: underline;'>6</span><span>480        </span><span style='text-decoration: underline;'>5</span><span>450        </span><span style='text-decoration: underline;'>6</span><span>000        </span><span style='text-decoration: underline;'>6</span><span>690        </span><span style='text-decoration: underline;'>6</span><span>620        </span><span style='text-decoration: underline;'>6</span><span>580
#&gt; </span><span style='color: #BCBCBC;'>10</span><span> 1990-10-01  </span><span style='text-decoration: underline;'>6</span><span>820        </span><span style='text-decoration: underline;'>6</span><span>480        </span><span style='text-decoration: underline;'>5</span><span>450        </span><span style='text-decoration: underline;'>6</span><span>000        </span><span style='text-decoration: underline;'>6</span><span>690        </span><span style='text-decoration: underline;'>6</span><span>620
#&gt; </span><span style='color: #949494;'># … with 320 more rows, and 19 more variables: lag_6_value &lt;dbl&gt;,</span><span>
#&gt; </span><span style='color: #949494;'>#   lag_7_value &lt;dbl&gt;, lag_8_value &lt;dbl&gt;, lag_9_value &lt;dbl&gt;,</span><span>
#&gt; </span><span style='color: #949494;'>#   lag_10_value &lt;dbl&gt;, lag_11_value &lt;dbl&gt;, lag_12_value &lt;dbl&gt;,</span><span>
#&gt; </span><span style='color: #949494;'>#   lag_13_value &lt;dbl&gt;, lag_14_value &lt;dbl&gt;, lag_15_value &lt;dbl&gt;,</span><span>
#&gt; </span><span style='color: #949494;'>#   lag_16_value &lt;dbl&gt;, lag_17_value &lt;dbl&gt;, lag_18_value &lt;dbl&gt;,</span><span>
#&gt; </span><span style='color: #949494;'>#   lag_19_value &lt;dbl&gt;, lag_20_value &lt;dbl&gt;, lag_21_value &lt;dbl&gt;,</span><span>
#&gt; </span><span style='color: #949494;'>#   lag_22_value &lt;dbl&gt;, lag_23_value &lt;dbl&gt;, lag_24_value &lt;dbl&gt;</span><span></div><div class='input'>
<span class='va'>train_data</span> <span class='op'>&lt;-</span> <span class='va'>m750_lagged</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>future_data</span> <span class='op'>&lt;-</span> <span class='va'>m750_lagged</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Modeling</span>
<span class='va'>model_fit_lm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"lm"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>value</span> <span class='op'>~</span> <span class='va'>date</span>, data <span class='op'>=</span> <span class='va'>train_data</span><span class='op'>)</span>

<span class='va'>model_fit_lm_recursive</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"lm"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>value</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>train_data</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>recursive</span><span class='op'>(</span>
        transform  <span class='op'>=</span> <span class='va'>recipe_lag</span>,
        train_tail <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='va'>train_data</span>, <span class='va'>FORECAST_HORIZON</span><span class='op'>)</span>
    <span class='op'>)</span>

<span class='va'>model_fit_lm_recursive</span>
</div><div class='output co'>#&gt; Recursive [parsnip model]
#&gt; 
#&gt; parsnip model object
#&gt; 
#&gt; Fit time:  4ms 
#&gt; 
#&gt; Call:
#&gt; stats::lm(formula = value ~ ., data = data)
#&gt; 
#&gt; Coefficients:
#&gt;  (Intercept)          date   lag_1_value   lag_2_value   lag_3_value  
#&gt;    164.14732       0.00677       0.61244       0.18402      -0.07128  
#&gt;  lag_4_value   lag_5_value   lag_6_value   lag_7_value   lag_8_value  
#&gt;      0.12089      -0.01750       0.07095       0.09785      -0.08053  
#&gt;  lag_9_value  lag_10_value  lag_11_value  lag_12_value  lag_13_value  
#&gt;      0.04887       0.03030      -0.01755       0.73318      -0.52958  
#&gt; lag_14_value  lag_15_value  lag_16_value  lag_17_value  lag_18_value  
#&gt;     -0.21410       0.07734      -0.13879       0.04351      -0.08894  
#&gt; lag_19_value  lag_20_value  lag_21_value  lag_22_value  lag_23_value  
#&gt;     -0.08732       0.06641      -0.05737      -0.02331       0.05754  
#&gt; lag_24_value  
#&gt;      0.15960  
#&gt; </div><div class='input'>
<span class='co'># Forecasting</span>
<span class='fu'><a href='modeltime_table.html'>modeltime_table</a></span><span class='op'>(</span>
    <span class='va'>model_fit_lm</span>,
    <span class='va'>model_fit_lm_recursive</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='update_model_description.html'>update_model_description</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"LM - Lag Roll"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='modeltime_forecast.html'>modeltime_forecast</a></span><span class='op'>(</span>
        new_data    <span class='op'>=</span> <span class='va'>future_data</span>,
        actual_data <span class='op'>=</span> <span class='va'>m750</span>,
        keep_data   <span class='op'>=</span> <span class='cn'>TRUE</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='plot_modeltime_forecast.html'>plot_modeltime_forecast</a></span><span class='op'>(</span>
        .interactive        <span class='op'>=</span> <span class='cn'>FALSE</span>,
        .conf_interval_show <span class='op'>=</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span>
</div><div class='img'><img src='recursive-1.png' alt='' width='700' height='433' /></div><div class='input'>

<span class='co'># METHOD 2: TRANSFORM FUNCTION ----</span>
<span class='co'># - Used for complex transformations via transformation function</span>

<span class='co'># Function run recursively that updates the forecasted dataset</span>
<span class='va'>lag_roll_transformer</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>data</span><span class='op'>)</span><span class='op'>{</span>
    <span class='va'>data</span> <span class='op'>%&gt;%</span>
        <span class='co'># Lags</span>
        <span class='fu'><a href='https://rdrr.io/pkg/timetk/man/tk_augment_lags.html'>tk_augment_lags</a></span><span class='op'>(</span><span class='va'>value</span>, .lags <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
        <span class='co'># Rolling Features</span>
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>rolling_mean_12 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/lead-lag.html'>lag</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/slider/man/slide.html'>slide_dbl</a></span><span class='op'>(</span>
            <span class='va'>value</span>, .f <span class='op'>=</span> <span class='va'>mean</span>, .before <span class='op'>=</span> <span class='fl'>12</span>, .complete <span class='op'>=</span> <span class='cn'>FALSE</span>
        <span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Data Preparation</span>
<span class='va'>m750_rolling</span> <span class='op'>&lt;-</span> <span class='va'>m750_extended</span> <span class='op'>%&gt;%</span>
    <span class='fu'>lag_roll_transformer</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>id</span><span class='op'>)</span>

<span class='va'>train_data</span> <span class='op'>&lt;-</span> <span class='va'>m750_rolling</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>future_data</span> <span class='op'>&lt;-</span> <span class='va'>m750_rolling</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Modeling</span>
<span class='va'>model_fit_lm</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"lm"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>value</span> <span class='op'>~</span> <span class='va'>date</span>, data <span class='op'>=</span> <span class='va'>train_data</span><span class='op'>)</span>

<span class='va'>model_fit_lm_recursive</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://parsnip.tidymodels.org/reference/linear_reg.html'>linear_reg</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"lm"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='va'>value</span> <span class='op'>~</span> <span class='va'>.</span>, data <span class='op'>=</span> <span class='va'>train_data</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'>recursive</span><span class='op'>(</span>
        transform  <span class='op'>=</span> <span class='va'>lag_roll_transformer</span>,
        train_tail <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='va'>train_data</span>, <span class='va'>FORECAST_HORIZON</span><span class='op'>)</span>
    <span class='op'>)</span>

<span class='va'>model_fit_lm_recursive</span>
</div><div class='output co'>#&gt; Recursive [parsnip model]
#&gt; 
#&gt; parsnip model object
#&gt; 
#&gt; Fit time:  4ms 
#&gt; 
#&gt; Call:
#&gt; stats::lm(formula = value ~ ., data = data)
#&gt; 
#&gt; Coefficients:
#&gt;     (Intercept)             date       value_lag1       value_lag2  
#&gt;       147.32008          0.01273          1.59298          0.76666  
#&gt;      value_lag3       value_lag4       value_lag5       value_lag6  
#&gt;         0.73081          0.76950          0.76871          0.74755  
#&gt;      value_lag7       value_lag8       value_lag9      value_lag10  
#&gt;         0.77872          0.72985          0.75257          0.76582  
#&gt;     value_lag11      value_lag12  rolling_mean_12  
#&gt;         0.79979          1.62469         -9.85822  
#&gt; </div><div class='input'>
<span class='co'># Forecasting</span>
<span class='fu'><a href='modeltime_table.html'>modeltime_table</a></span><span class='op'>(</span>
    <span class='va'>model_fit_lm</span>,
    <span class='va'>model_fit_lm_recursive</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='update_model_description.html'>update_model_description</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"LM - Lag Roll"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='modeltime_forecast.html'>modeltime_forecast</a></span><span class='op'>(</span>
        new_data    <span class='op'>=</span> <span class='va'>future_data</span>,
        actual_data <span class='op'>=</span> <span class='va'>m750</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='plot_modeltime_forecast.html'>plot_modeltime_forecast</a></span><span class='op'>(</span>
        .interactive        <span class='op'>=</span> <span class='cn'>FALSE</span>,
        .conf_interval_show <span class='op'>=</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span>
</div><div class='img'><img src='recursive-2.png' alt='' width='700' height='433' /></div><div class='input'>

</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


